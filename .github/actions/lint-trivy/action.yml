name: "Lint with Trivy"
description: "Run trivy vulnerability scanner and generate SBOM"

runs:
  using: "composite"
  steps:
    - name: Run trivy filesystem scan
      shell: bash
      run: |
        echo "Running trivy filesystem scan..."
        trivy fs . --scanners vuln,secret,misconfig

    - name: Generate trivy SBOM
      shell: bash
      run: |
        echo "Generating trivy SBOM..."
        trivy fs . --format cyclonedx --output trivy-sbom.json

    - name: Upload SBOM artifact
      uses: actions/upload-artifact@bbbca2ddaa5d8feaa63e36b76fdaad77386f024f # v7
      with:
        name: trivy-sbom
        path: trivy-sbom.json
        retention-days: 30
